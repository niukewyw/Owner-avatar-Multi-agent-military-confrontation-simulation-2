# 军事对战栅格化仿真环境开发需求文档

## 项目概述
本项目旨在开发一个模拟军事对战的栅格化仿真环境，作为多智能体强化学习（MARL）的环境前置工作。环境基于300x300格子的地图，支持我方和敌方智能体的对战模拟。双方智能体类型相同，包括：坦克、攻击型自爆无人机、火炮、战车、侦察车、侦察型无人机。环境包含随机分布的障碍物。当前阶段，双方智能体均可通过规则进行控制。后期将融合MAPPO、QMIX、VDN等多智能体强化学习算法，以实现智能体决策优化。最终目标是通过命令行执行Python脚本（如`python demo.py --map xxx --render=True`）来可视化双方战斗过程。

## 智能体类型
- **我方智能体类型**：坦克、攻击型自爆无人机、火炮、战车、侦察车、侦察型无人机。
- **敌方智能体类型**：与我方相同，包括坦克、攻击型自爆无人机、火炮、战车、侦察车、侦察型无人机。

每个智能体类型需有一个独立的配置文件，用于定义其属性。

## 智能体配置文件参数
每个智能体类型的配置文件应包含以下参数（以JSON或其他易读格式存储）。参数单位基于格子数，除非特别说明。以下是核心参数列表，根据实际情况补充其他必要参数（如视野范围、燃料限制、特殊能力等）：

- **length**：长度（格子数，整数）。
- **width**：宽度（格子数，整数）。
- **health**：血量（整数，表示耐久度）。
- **speed**：移速（每回合移动格子数，整数）。
- **can_attack**：是否可以攻击（布尔值，True/False）。
- **attack_range**：攻击距离（格子数，整数）。
- **attack_damage**：攻击伤害（整数，表示每次攻击造成的伤害值）。

**补充参数建议**（根据军事模拟实际情况添加）：
- **vision_range**：视野范围（格子数，整数，表示能侦察到的距离）。
- **armor**：装甲值（整数，减少受到伤害的比例或值）。
- **cost**：部署成本（整数，用于平衡地图配置）。
- **special_ability**：特殊能力（字符串，例如“自爆”对于自爆无人机、“远程侦察”对于侦察型无人机）。
- **movement_type**：移动类型（字符串，例如“陆地”、“空中”，影响障碍物穿越）。
- **reload_time**：攻击冷却时间（回合数，整数）。

配置文件示例路径：`configs/agent_types/tank.json` 等。

## 环境和地图
- **地图大小**：统一为300x300格子。
- **地图数量**：若干个地图，每个地图的双方智能体配置不同。
  - 示例配置类型：
    - 侧重攻击：更多攻击型智能体（如坦克、火炮），强调进攻能力。
    - 侧重防御：更多侦察和防护型智能体（如侦察车、战车），强调耐久和情报收集。
- **障碍物**：地图上随机分布障碍物（例如墙壁、河流、山地），影响移动和视线。障碍物可通过概率生成或预定义。
- **智能体配置**：每个地图指定我方和敌方的智能体数量、类型和初始位置。配置可存储在地图文件中（如`maps/map_xxx.json`）。

## 控制方式
- **双方控制**：当前阶段均由规则控制（例如基于简单AI规则，如最近目标攻击、路径规划等）。后期将扩展为多智能体强化学习算法控制，包括MAPPO、QMIX、VDN等，支持智能体学习和决策优化。

## 仿真逻辑
- **回合制或实时**：建议采用回合制模拟，便于控制和可视化。每回合包括移动、侦察、攻击等阶段。设计时需考虑与MARL算法的兼容性，例如定义观察空间（observation space）、动作空间（action space）和奖励函数（reward function）。
- **胜负条件**：例如一方血量全部耗尽，或占领特定格子。需定义清晰的结束条件，并支持MARL中的episode终止。
- **随机性**：障碍物随机生成，初始位置可有随机偏移，以增加环境的不确定性，便于强化学习训练。

## 任务清单
为了实现项目，以下是结构化的任务清单，按优先级和逻辑顺序排列：

1. **定义智能体配置文件**：
   - 为每个智能体类型创建独立的配置文件。
   - 填充核心参数，并补充必要参数。

2. **设计地图系统**：
   - 创建多个地图配置文件（至少3-5个），包括不同侧重（攻击、防御）。
   - 实现随机障碍物生成逻辑（例如使用噪声算法或预设模板）。

3. **构建仿真环境核心**：
   - 实现300x300格子地图表示（使用NumPy数组或类似结构）。
   - 加载地图配置，放置智能体和障碍物。
   - 实现智能体移动、攻击、侦察等基本行为（规则-based，例如A*路径规划、最近敌人优先攻击）。
   - 定义MARL兼容接口：观察空间（e.g., 局部网格视图、敌方位置）、动作空间（e.g., 移动方向、攻击目标）、奖励函数（e.g., 伤害奖励、生存奖励）。

4. **实现规则控制逻辑**：
   - 为我方和敌方定义行为规则（例如巡逻、追击、防御）。
   - 处理碰撞、视线阻挡、伤害计算等。

5. **开发可视化模块**：
   - 使用库如Pygame、Matplotlib或Tkinter实现渲染。
   - 支持命令行参数：`--map xxx`（指定地图）、`--render=True`（启用可视化）。

6. **集成demo脚本**：
   - 创建`demo.py`作为入口。
   - 解析命令行参数，加载对应地图，运行仿真，并可选渲染战斗过程。

7. **测试与调试**：
   - 测试不同地图的平衡性。
   - 确保可视化正确显示智能体位置、血量、攻击等。
   - 处理边缘情况，如智能体重叠、障碍物阻塞。
   - 验证环境接口与MARL算法的潜在兼容性。

8. **优化与扩展**：
   - 优化性能（300x300格子需高效计算）。
   - 文档化代码，便于未来扩展（如添加MARL算法集成）。
   - 规划后期融合MAPPO、QMIX、VDN等算法：实现算法接口、训练循环、评估指标（如胜率、平均奖励）。

## 最终效果
- 用户可在终端执行`python demo.py --map xxx --render=True`，其中`xxx`为地图名称（例如`attack_focused`）。
- 脚本将加载指定地图，启动仿真，并实时可视化双方战斗过程（例如窗口显示格子地图、智能体图标、血量条、攻击动画等）。
- 无渲染模式（`--render=False`）可用于纯模拟或日志输出。
- 环境设计需支持后期无缝集成MARL算法，实现智能体训练和测试。